import{c as g,j as e,b as u}from"./client-d1e7a8f2.js";import{s as m,q as p,k as f}from"./config-4af2f20c.js";import{s as x,l as j,N as w}from"./setup-playground-sync-d0e0de2f.js";const y="time-traveling";async function E(n=[]){const o=Math.round((1+Math.random())*1e6);console.log({autoincrementOffset:o});const i=document.getElementById("wp"),a=await m({iframe:i,remoteUrl:p().toString()}),c=new w;await x(a,{autoincrementOffset:o,transport:c,middlewares:[j(y),S]}),n.forEach(t=>c.injectChanges(t)),await f(a,{username:"admin",password:"password"}),await a.goTo("/")}const S={beforeSend(n){return k(n),n},afterReceive(n){return n}},d=({envelopes:n})=>{const[o,i]=u.useState(new Set);function a(t){i(r=>{const s=new Set(r);return s.has(t)?s.delete(t):s.add(t),s})}function c(){const t=n.filter(r=>!o.has(r.id));console.log("Replaying"),E(t)}return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:c,children:"Replay selected"}),e.jsx("ul",{children:[...n].reverse().map(t=>e.jsx("li",{children:e.jsxs("label",{children:[e.jsx("div",{children:e.jsxs("h4",{children:[e.jsx("input",{type:"checkbox",checked:!o.has(t.id),onChange:()=>a(t.id)}),"Â  Batch of changes #$",t.id]})}),e.jsx("h5",{children:"SQL changes"}),e.jsx("ul",{children:t.sql.map((r,s)=>e.jsx("li",{children:JSON.stringify(r)},s))}),e.jsx("h5",{children:"FS changes"}),e.jsx("ul",{children:t.fs.map((r,s)=>e.jsx("li",{children:JSON.stringify(r)},s))})]})},t.id))})]})},b=document.getElementById("logs"),h=g(b);h.render(e.jsx(d,{envelopes:[]}));const l=[];function k(n){!n.sql.length&&!n.fs.length||(l.push({...n,id:l.length}),h.render(e.jsx(d,{envelopes:l})))}export{E as restartDemo};
